<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã‚³ãƒˆãƒãƒˆåºƒå ´</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #0f172a; --bg-surface: #1e293b; --bg-glass: rgba(30, 41, 59, 0.7);
            --primary: #6366f1; --primary-hover: #4f46e5;
            --text-main: #f8fafc; --text-muted: #94a3b8;
            --accent: #3b82f6; --danger: #ef4444; --success: #10b981; --warning: #f59e0b;
            --nav-h: 68px; --radius: 16px;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            background: linear-gradient(135deg, #020617 0%, #1e1b4b 100%);
            color: var(--text-main);
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            margin: 0; overflow: hidden; height: 100vh;
        }

        /* SVG Icon Style */
        .icon { width: 24px; height: 24px; fill: currentColor; }
        .icon-sm { width: 18px; height: 18px; }

        /* Animation */
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .screen { display: none; width: 100%; height: 100%; flex-direction: column; align-items: center; justify-content: center; }
        .screen.active { display: flex; animation: fadeUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }

        /* Layout */
        .app-shell { width: 100%; height: 100%; display: flex; flex-direction: column; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(20px); position: relative; }
        
        @media (min-width: 768px) {
            .app-shell { flex-direction: row; max-width: 1200px; margin: 0 auto; border-left: 1px solid #334155; border-right: 1px solid #334155; }
            .nav-bar { width: 240px !important; height: 100% !important; flex-direction: column !important; border-top: none !important; border-right: 1px solid #334155; padding: 40px 20px !important; justify-content: flex-start !important; }
            .nav-item { flex: none !important; width: 100%; height: 50px; flex-direction: row !important; gap: 15px; padding-left: 20px; margin-bottom: 10px; border-radius: 12px; }
            .nav-item.active { background: rgba(99, 102, 241, 0.1); color: var(--primary) !important; }
            .content-wrapper { padding-bottom: 0 !important; }
            .mobile-header { display: none !important; }
        }

        .content-wrapper { flex: 1; display: flex; flex-direction: column; height: 100%; overflow: hidden; position: relative; }
        .scroll-content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }

        /* UI Components */
        .card {
            background: var(--bg-surface); border: 1px solid #334155; border-radius: var(--radius);
            padding: 24px; margin-bottom: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .auth-card { max-width: 400px; width: 90%; text-align: center; }

        input, select, textarea {
            width: 100%; background: #0f172a; border: 1px solid #334155; color: #fff;
            padding: 14px; border-radius: 12px; font-size: 16px; margin: 8px 0; outline: none; transition: 0.2s;
        }
        input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); }

        .btn {
            width: 100%; padding: 14px; border: none; border-radius: 12px; font-weight: bold; font-size: 15px;
            cursor: pointer; color: white; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.2s;
        }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: var(--primary); }
        .btn-success { background: var(--success); }
        .btn-danger { background: var(--danger); }
        .btn-ghost { background: transparent; color: var(--text-muted); font-weight: normal; }
        .btn-ghost:hover { color: var(--text-main); text-decoration: underline; }

        /* Navigation */
        .nav-bar {
            position: absolute; bottom: 0; width: 100%; height: var(--nav-h);
            background: rgba(30, 41, 59, 0.9); backdrop-filter: blur(10px);
            border-top: 1px solid #334155; display: flex; justify-content: space-around; z-index: 100;
        }
        .nav-item {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: var(--text-muted); cursor: pointer; transition: 0.3s;
        }
        .nav-item.active { color: var(--primary); }

        /* Chat & List */
        .chat-container { display: flex; flex-direction: column; gap: 12px; padding-bottom: 20px; }
        .msg { max-width: 80%; padding: 12px 16px; border-radius: 18px; font-size: 0.95rem; line-height: 1.5; }
        .msg-me { align-self: flex-end; background: var(--primary); border-bottom-right-radius: 4px; }
        .msg-other { align-self: flex-start; background: #334155; border-bottom-left-radius: 4px; }
        .msg-img { max-width: 100%; border-radius: 12px; margin-top: 8px; }

        .list-item { background: #0f172a; border: 1px solid #334155; padding: 16px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        
        .resource-bar { display: flex; justify-content: space-around; background: #0f172a; padding: 15px; border-radius: 16px; margin-bottom: 20px; font-weight: bold; border: 1px solid #334155; }
        
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: var(--success); padding: 12px 24px; border-radius: 30px; font-weight: bold; display: none; z-index: 9999; box-shadow: 0 10px 30px rgba(0,0,0,0.3); white-space: nowrap; }
        
        .badge-limit { font-size: 0.75rem; background: #334155; padding: 4px 8px; border-radius: 6px; }
        .cand-chip { display: inline-block; background: #334155; padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; margin: 4px; cursor: pointer; border: 1px solid var(--primary); }
    </style>
</head>
<body>

    <div id="toast"></div>

    <!-- 1. ãƒ­ã‚°ã‚¤ãƒ³ -->
    <div id="screen-login" class="screen active">
        <div class="card auth-card">
            <h1 style="margin-bottom:10px;">ã‚³ãƒˆãƒãƒˆåºƒå ´</h1>
            <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom:24px;">Cotobato Plaza - Ultimate</p>
            
            <input type="text" id="login-u" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å" autocomplete="off">
            <input type="password" id="login-p" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
            <button class="btn btn-primary" onclick="doLogin()">
                <svg class="icon" viewBox="0 0 24 24"><path d="M10 17v-4h11v-2H10V7l-5 5 5 5zm-8 3h18v-2H2v-2h18V8H2V6h18a2 2 0 012 2v12a2 2 0 01-2 2H2v-2z"/></svg> ãƒ­ã‚°ã‚¤ãƒ³
            </button>
            <button class="btn btn-ghost" onclick="go('screen-register')">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã¯ã“ã¡ã‚‰</button>
            
            <div id="status-bar" style="margin-top:15px; font-size:0.8rem; color:var(--warning);">â— ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šå¾…æ©Ÿä¸­...</div>
        </div>
    </div>

    <!-- 2. ç™»éŒ² -->
    <div id="screen-register" class="screen">
        <div class="card auth-card">
            <h2>æ–°è¦ç™»éŒ²</h2>
            <input type="text" id="reg-u" placeholder="å¸Œæœ›ID (åŠè§’è‹±æ•°)">
            <div id="cand-area" style="display:none; text-align:left; margin-bottom:10px;">
                <small style="color:var(--danger)">â€»ä½¿ç”¨æ¸ˆã¿ã§ã™ã€‚å€™è£œ:</small><br>
                <div id="cand-list"></div>
            </div>
            <input type="password" id="reg-p" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
            <input type="text" id="reg-n" placeholder="è¡¨ç¤ºå (ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ )">
            
            <button class="btn btn-success" onclick="doRegister()">
                <svg class="icon" viewBox="0 0 24 24"><path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg> ç™»éŒ²ã—ã¦é–‹å§‹
            </button>
            <button class="btn btn-ghost" onclick="go('screen-login')">æˆ»ã‚‹</button>
        </div>
    </div>

    <!-- 3. ãƒ¡ã‚¤ãƒ³ -->
    <div id="screen-main" class="screen" style="padding:0;">
        <div class="app-shell">
            <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="nav-bar">
                <div class="nav-item active" onclick="tab('home',this)">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
                    <span>ãƒ›ãƒ¼ãƒ </span>
                </div>
                <div class="nav-item" onclick="tab('chat',this)">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
                    <span>ãƒãƒ£ãƒƒãƒˆ</span>
                </div>
                <div class="nav-item" onclick="tab('trade',this)">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/></svg>
                    <span>äº¤æ›</span>
                </div>
                <div class="nav-item" onclick="tab('settings',this)">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 00.12-.61l-1.92-3.32a.488.488 0 00-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 00-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 00-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                    <span>è¨­å®š</span>
                </div>
                <div class="nav-item" id="nav-adm" style="display:none;" onclick="tab('admin',this)">
                    <svg class="icon" viewBox="0 0 24 24" style="fill:var(--warning);"><path d="M5 16L3 5l5.5 5L12 4l3.5 6L21 5l-2 11h-14zm14 3c0 .6-.4 1-1 1H6c-.6 0-1-.4-1-1v-1h14v1z"/></svg>
                    <span style="color:var(--warning)">é‹å–¶</span>
                </div>
            </div>

            <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            <div class="content-wrapper">
                <div class="mobile-header" style="padding:15px 20px; background:rgba(15,23,42,0.9); border-bottom:1px solid #334155; display:flex; justify-content:space-between;">
                    <div id="app-ttl" style="font-weight:800; font-size:1.2rem;">Cotobato</div>
                    <div id="head-user" style="font-size:0.8rem; color:var(--text-muted);">Guest</div>
                </div>

                <div class="scroll-content">
                    
                    <!-- ãƒ›ãƒ¼ãƒ  -->
                    <div id="view-home">
                        <div class="resource-bar">
                            <span>ğŸª™ <span id="v-coin">0</span></span>
                            <span>ğŸ’ <span id="v-dia">0</span></span>
                            <span>Lv. <span id="v-lv">1</span></span>
                        </div>

                        <button class="btn btn-primary" style="background:var(--warning); color:#000; margin-bottom:20px;" onclick="openGifts()">
                            <svg class="icon" viewBox="0 0 24 24"><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z"/></svg>
                            ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆBOX
                        </button>

                        <div class="card">
                            <h3 style="display:flex; justify-content:space-between;">
                                ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
                                <span class="badge-limit" id="lim-cloud">æ®‹2å›</span>
                            </h3>
                            <div style="display:flex; gap:10px;">
                                <button class="btn btn-primary" onclick="bkCloud()">ã‚¯ãƒ©ã‚¦ãƒ‰ä¿å­˜</button>
                                <button class="btn" style="background:#334155" onclick="rsCloud()">ã‚¯ãƒ©ã‚¦ãƒ‰å¾©å…ƒ</button>
                            </div>
                            <hr style="border-color:#334155; margin:15px 0;">
                            <h3 style="display:flex; justify-content:space-between; font-size:0.9rem;">
                                ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜
                                <span class="badge-limit" id="lim-local">æ®‹5å›</span>
                            </h3>
                            <button class="btn btn-ghost" style="border:1px solid #334155;" onclick="bkLocal()">ç«¯æœ«ã«ä¿å­˜</button>
                            <div id="bk-hist" style="margin-top:10px; font-size:0.8rem; color:var(--text-muted);"></div>
                        </div>

                        <h3>ãŠçŸ¥ã‚‰ã›</h3>
                        <div id="news-box">èª­ã¿è¾¼ã¿ä¸­...</div>
                    </div>

                    <!-- ãƒãƒ£ãƒƒãƒˆ -->
                    <div id="view-chat" style="display:none;">
                        <div id="chat-box" class="chat-container"></div>
                        <div style="display:flex; gap:10px; margin-top:10px;">
                            <label class="btn" style="width:50px; background:#334155; padding:0; margin:0;">
                                <svg class="icon" viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                                <input type="file" id="chat-img" accept="image/*" style="display:none;" onchange="prevImg(this)">
                            </label>
                            <input type="text" id="chat-in" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸..." style="margin:0;">
                            <button class="btn btn-primary" style="width:60px; margin:0;" onclick="sendChat()">
                                <svg class="icon" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                            </button>
                        </div>
                        <div id="img-prev" style="font-size:0.8rem; color:var(--accent);"></div>
                    </div>

                    <!-- äº¤æ› -->
                    <div id="view-trade" style="display:none;">
                        <div class="card">
                            <h3>å‡ºå“ã™ã‚‹</h3>
                            <div style="display:flex; gap:5px; align-items:center;">
                                <select id="tr-give-t"><option value="coins">ã‚³ã‚¤ãƒ³</option><option value="diamonds">ãƒ€ã‚¤ãƒ¤</option></select>
                                <input type="number" id="tr-give-v" placeholder="é‡" style="margin:0;">
                            </div>
                            <div style="text-align:center; font-size:1.2rem;">â‡…</div>
                            <div style="display:flex; gap:5px; align-items:center;">
                                <select id="tr-want-t"><option value="coins">ã‚³ã‚¤ãƒ³</option><option value="diamonds">ãƒ€ã‚¤ãƒ¤</option></select>
                                <input type="number" id="tr-want-v" placeholder="æ±‚" style="margin:0;">
                            </div>
                            <button class="btn btn-success" onclick="mkTrade()">å‡ºå“</button>
                        </div>
                        <div id="trade-list"></div>
                    </div>

                    <!-- è¨­å®š -->
                    <div id="view-settings" style="display:none;">
                        <div class="card">
                            <h3>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</h3>
                            <input type="text" id="set-name" placeholder="æ–°ã—ã„è¡¨ç¤ºå">
                            <button class="btn btn-primary" onclick="updName()">åå‰å¤‰æ›´</button>
                            <button class="btn btn-danger" onclick="location.reload()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                        </div>
                        <div class="card">
                            <h3>é‹å–¶èªè¨¼</h3>
                            <input type="password" id="adm-pass" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
                            <button class="btn" style="background:#334155" onclick="authAdm()">èªè¨¼</button>
                            <p style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">â€»PC: Ctrl+Shift+Q / ã‚¹ãƒãƒ›: ã‚¿ã‚¤ãƒˆãƒ«7å›ã‚¿ãƒƒãƒ—ã§è©¦é¨“é–‹å§‹</p>
                        </div>
                    </div>

                    <!-- é‹å–¶ -->
                    <div id="view-admin" style="display:none;">
                        <div class="card" style="border-color:var(--warning);">
                            <h3 style="color:var(--warning);">é‹å–¶ãƒ‘ãƒãƒ«</h3>
                            <input type="text" id="adm-news-txt" placeholder="ãŠçŸ¥ã‚‰ã›æœ¬æ–‡">
                            <button class="btn btn-primary" onclick="postNews()">é…ä¿¡</button>
                            <hr style="border-color:#334155; margin:15px 0;">
                            <div style="display:flex; gap:5px;">
